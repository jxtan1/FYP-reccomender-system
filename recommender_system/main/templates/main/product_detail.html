{% extends 'main/base.html' %}

{% block title %}Product Page{% endblock %}

{% block content %}
<!-- detail.html -->
<h1>{{ product.name }}</h1>
<p>Price: <br>${{ product.price }} </p>
{% if user.account == 'B' %}
<a href="{% url 'add_to_cart' product.product_id%}">Add to Cart</a>
{% endif %}
<p>Sold by: <a href="{% url 'seller_store' seller.username %}">{{ seller.username }}</a></p>

<p>Sold: {{ product.sold_count }}</p>





<div class="product-image">
    {% if product.image %}
        <img src="{{ product.image }}" alt="{{ product.name }}" style="max-width: 300px; max-height: 300px;">
    {% else %}
        <p>No Image Available</p>
    {% endif %}
</div>

<br>
<p>Average Rating: {{ average_rating|default:"No ratings yet"|floatformat:1  }}</p>

<div class="rating-stars">
    {% if average_rating %}
        {% with avg_rating=average_rating|floatformat:1 %}
        {% for i in "12345" %}
            {% if i <= avg_rating %}
                <i class="fas fa-star" style="color: gold;"></i>  <!-- Solid gold star icon -->
            {% else %}
                <i class="far fa-star"></i>  <!-- Outline star icon from Font Awesome -->
            {% endif %}
        {% endfor %}
        {% endwith %}
    {% else %}
        <p>No ratings yet</p>
    {% endif %}
</div>
<p><small>{{ total_ratings|default:"No ratings yet" }} ratings</small></p>

<h2>Ratings and Reviews</h2>
<!-- Review here -->
{% if user.account == "B" %}    
    <h2>Add a Review</h2>
    <form method="post" action="{% url 'review_success' product_id=product.pk %}">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Submit Review</button>
    </form>
{% endif %}
<ul>
    {% for review in reviews %}
    <div class="review" style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background-color: #f9f9f9;">
        <div class="rating">
            <strong>Rating:</strong> {{ review.rating }}
        </div>
        <div class="comment">
            <strong>Comment:</strong> {{ review.comment }}
        </div>
        <div class="username">
            <strong>Username:</strong> {{ review.username.username }}
        </div>

        <!-- You can add additional information from the review model here -->
    </div>
    {% empty %}
    <p> No review and rating yet :(</p>
    {% endfor %}
</ul>

<!-- Pagination controls -->
<div class="row justify-content-center">
    <div class="col-auto">
        <span style="display: inline-block;">
            {% if reviews.has_previous %}
                <a href="?page=1" class="btn btn-outline-secondary">First</a>
                <a href="?page={{ reviews.previous_page_number }}" class="btn btn-outline-secondary">Previous</a>
            {% endif %}

            <span style="font-weight: bold; background-color: #0405176f; color: #fff; text-decoration: none; padding: 5px 10px; margin: 0 5px; border: 1px solid #007bff; border-radius: 4px;">{{ reviews.number }}</span>

            {% if reviews.has_next %}
                <a href="?page={{ reviews.next_page_number }}" class="btn btn-outline-secondary">Next</a>
                <a href="?page={{ reviews.paginator.num_pages }}" class="btn btn-outline-secondary">Last</a>
            {% endif %}
        </span>
    </div>
</div>


{% endblock %}

